// https://d3js.org/d3-contour/ v4.0.0 Copyright 2012-2021 Mike Bostock
!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-array"],n):n((r="undefined"!=typeof globalThis?globalThis:r||self).d3=r.d3||{},r.d3)}(this,(function(r,n){"use strict";var t=Array.prototype.slice;function e(r,n){return r-n}var o=r=>()=>r;function i(r,n){for(var t,e=-1,o=n.length;++e<o;)if(t=u(r,n[e]))return t;return 0}function u(r,n){for(var t=n[0],e=n[1],o=-1,i=0,u=r.length,f=u-1;i<u;f=i++){var c=r[i],h=c[0],s=c[1],l=r[f],d=l[0],g=l[1];if(a(c,l,n))return 0;s>e!=g>e&&t<(d-h)*(e-s)/(g-s)+h&&(o=-o)}return o}function a(r,n,t){var e,o,i,u;return function(r,n,t){return(n[0]-r[0])*(t[1]-r[1])==(t[0]-r[0])*(n[1]-r[1])}(r,n,t)&&(o=r[e=+(r[0]===n[0])],i=t[e],u=n[e],o<=i&&i<=u||u<=i&&i<=o)}function f(){}var c=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function h(){var r=1,u=1,a=n.thresholdSturges,h=g;function s(r){var t=a(r);if(Array.isArray(t))t=t.slice().sort(e);else{const e=n.extent(r),o=n.tickStep(e[0],e[1],t);t=n.ticks(Math.floor(e[0]/o)*o,Math.floor(e[1]/o-1)*o,t)}return t.map((n=>l(r,n)))}function l(n,t){var e=[],o=[];return function(n,t,e){var o,i,a,f,h,s,l=new Array,g=new Array;o=i=-1,f=n[0]>=t,c[f<<1].forEach(v);for(;++o<r-1;)a=f,f=n[o+1]>=t,c[a|f<<1].forEach(v);c[f<<0].forEach(v);for(;++i<u-1;){for(o=-1,f=n[i*r+r]>=t,h=n[i*r]>=t,c[f<<1|h<<2].forEach(v);++o<r-1;)a=f,f=n[i*r+r+o+1]>=t,s=h,h=n[i*r+o+1]>=t,c[a|f<<1|h<<2|s<<3].forEach(v);c[f|h<<3].forEach(v)}o=-1,h=n[i*r]>=t,c[h<<2].forEach(v);for(;++o<r-1;)s=h,h=n[i*r+o+1]>=t,c[h<<2|s<<3].forEach(v);function v(r){var n,t,u=[r[0][0]+o,r[0][1]+i],a=[r[1][0]+o,r[1][1]+i],f=d(u),c=d(a);(n=g[f])?(t=l[c])?(delete g[n.end],delete l[t.start],n===t?(n.ring.push(a),e(n.ring)):l[n.start]=g[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete g[n.end],n.ring.push(a),g[n.end=c]=n):(n=l[c])?(t=g[f])?(delete l[n.start],delete g[t.end],n===t?(n.ring.push(a),e(n.ring)):l[t.start]=g[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete l[n.start],n.ring.unshift(u),l[n.start=f]=n):l[f]=g[c]={start:f,end:c,ring:[u,a]}}c[h<<3].forEach(v)}(n,t,(function(r){h(r,n,t),function(r){for(var n=0,t=r.length,e=r[t-1][1]*r[0][0]-r[t-1][0]*r[0][1];++n<t;)e+=r[n-1][1]*r[n][0]-r[n-1][0]*r[n][1];return e}(r)>0?e.push([r]):o.push(r)})),o.forEach((function(r){for(var n,t=0,o=e.length;t<o;++t)if(-1!==i((n=e[t])[0],r))return void n.push(r)})),{type:"MultiPolygon",value:t,coordinates:e}}function d(n){return 2*n[0]+n[1]*(r+1)*4}function g(n,t,e){n.forEach((function(n){var o,i=n[0],a=n[1],f=0|i,c=0|a,h=t[c*r+f];i>0&&i<r&&f===i&&(o=t[c*r+f-1],n[0]=i+(e-o)/(h-o)-.5),a>0&&a<u&&c===a&&(o=t[(c-1)*r+f],n[1]=a+(e-o)/(h-o)-.5)}))}return s.contour=l,s.size=function(n){if(!arguments.length)return[r,u];var t=Math.floor(n[0]),e=Math.floor(n[1]);if(!(t>=0&&e>=0))throw new Error("invalid size");return r=t,u=e,s},s.thresholds=function(r){return arguments.length?(a="function"==typeof r?r:Array.isArray(r)?o(t.call(r)):o(r),s):a},s.smooth=function(r){return arguments.length?(h=r?g:f,s):h===g},s}function s(r){return r[0]}function l(r){return r[1]}function d(){return 1}r.contourDensity=function(){var r=s,e=l,i=d,u=960,a=500,f=20,c=2,g=3*f,v=u+2*g>>c,p=a+2*g>>c,y=o(20);function w(t){var o=new Float32Array(v*p),u=Math.pow(2,-c),a=-1;for(const n of t){var h=(r(n,++a,t)+g)*u,s=(e(n,a,t)+g)*u,l=+i(n,a,t);if(h>=0&&h<v&&s>=0&&s<p){var d=Math.floor(h),y=Math.floor(s),w=h-d-.5,E=s-y-.5;o[d+y*v]+=(1-w)*(1-E)*l,o[d+1+y*v]+=w*(1-E)*l,o[d+1+(y+1)*v]+=w*E*l,o[d+(y+1)*v]+=(1-w)*E*l}}return n.blur2({data:o,width:v,height:p},f*u),o}function E(r){var t=w(r),e=y(t),o=Math.pow(2,2*c);return Array.isArray(e)||(e=n.ticks(Number.MIN_VALUE,n.max(t)/o,e)),h().size([v,p]).thresholds(e.map((r=>r*o)))(t).map(((r,n)=>(r.value=+e[n],M(r))))}function M(r){return r.coordinates.forEach(A),r}function A(r){r.forEach(m)}function m(r){r.forEach(b)}function b(r){r[0]=r[0]*Math.pow(2,c)-g,r[1]=r[1]*Math.pow(2,c)-g}function x(){return v=u+2*(g=3*f)>>c,p=a+2*g>>c,E}return E.contours=function(r){var t=w(r),e=h().size([v,p]),o=Math.pow(2,2*c),i=r=>{r=+r;var n=M(e.contour(t,r*o));return n.value=r,n};return Object.defineProperty(i,"max",{get:()=>n.max(t)/o}),i},E.x=function(n){return arguments.length?(r="function"==typeof n?n:o(+n),E):r},E.y=function(r){return arguments.length?(e="function"==typeof r?r:o(+r),E):e},E.weight=function(r){return arguments.length?(i="function"==typeof r?r:o(+r),E):i},E.size=function(r){if(!arguments.length)return[u,a];var n=+r[0],t=+r[1];if(!(n>=0&&t>=0))throw new Error("invalid size");return u=n,a=t,x()},E.cellSize=function(r){if(!arguments.length)return 1<<c;if(!((r=+r)>=1))throw new Error("invalid cell size");return c=Math.floor(Math.log(r)/Math.LN2),x()},E.thresholds=function(r){return arguments.length?(y="function"==typeof r?r:Array.isArray(r)?o(t.call(r)):o(r),E):y},E.bandwidth=function(r){if(!arguments.length)return Math.sqrt(f*(f+1));if(!((r=+r)>=0))throw new Error("invalid bandwidth");return f=(Math.sqrt(4*r*r+1)-1)/2,x()},E},r.contours=h,Object.defineProperty(r,"__esModule",{value:!0})}));
